FROM python:3.11-slim

# -------------------------------------------------------------------
# üõ† Installazione strumenti di base
# -------------------------------------------------------------------
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# -------------------------------------------------------------------
# üìÇ Cartella di lavoro nel container
# -------------------------------------------------------------------
WORKDIR /app

# -------------------------------------------------------------------
# üì¶ Installazione dipendenze Python
# Assumiamo che requirements.txt sia dentro la cartella "peer/" insieme a questo Dockerfile
# -------------------------------------------------------------------
COPY requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir -r /app/requirements.txt

# -------------------------------------------------------------------
# üîÑ Copia tutto il codice Python
# Dato che il build context √® la cartella "peer/", copiando "."
# stiamo copiando direttamente main.py, base.py, api.py, ecc. dentro /app/
# -------------------------------------------------------------------
COPY . /app/

# -------------------------------------------------------------------
# üìÅ Directory dati
# -------------------------------------------------------------------
RUN mkdir -p /app/data

# -------------------------------------------------------------------
# ‚öôÔ∏è File Python da eseguire
# CAMBIAMENTO: Puntiamo al nuovo "cervello" main.py
# -------------------------------------------------------------------
ENV PEER_FILE=main.py

# -------------------------------------------------------------------
# üöÄ Avvio
# -------------------------------------------------------------------
CMD ["sh", "-c", "python $PEER_FILE"]