services:
  # üõ∞Ô∏è iTracker
  itracker:
    build:
      context: ../peer
    container_name: itracker
    command: [ "python", "itracker.py" ]
    ports:
      - "6000:6000"
    networks:
      - p4p_net

  # üß© Peer 1 (ISP_A, Region_A) - Source (Low Cost)
  peer1:
    build:
      context: ../peer
    container_name: peer1_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer2_p4p:5000,peer3_p4p:5000,peer4_p4p:5000,peer5_p4p:5000,peer6_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer1_p4p:5000
      - ISP=isp_a
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer1:/app/data
    ports:
      - "5001:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 2 (ISP_A, Region_B) - CLIENT
  peer2:
    build:
      context: ../peer
    container_name: peer2_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer3_p4p:5000,peer4_p4p:5000,peer5_p4p:5000,peer6_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer2_p4p:5000
      - ISP=isp_a
      - REGION=region_b
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer2:/app/data
    ports:
      - "5002:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 3 (ISP_B, Region_A) - Source (High Cost)
  peer3:
    build:
      context: ../peer
    container_name: peer3_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer2_p4p:5000,peer4_p4p:5000,peer5_p4p:5000,peer6_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer3_p4p:5000
      - ISP=isp_b
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer3:/app/data
    ports:
      - "5003:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 4 (ISP_A, Region_A) - Source (Low Cost)
  peer4:
    build:
      context: ../peer
    container_name: peer4_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer2_p4p:5000,peer3_p4p:5000,peer5_p4p:5000,peer6_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer4_p4p:5000
      - ISP=isp_a
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer4:/app/data
    ports:
      - "5004:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 5 (ISP_B, Region_A) - Source (High Cost)
  peer5:
    build:
      context: ../peer
    container_name: peer5_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer2_p4p:5000,peer3_p4p:5000,peer4_p4p:5000,peer6_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer5_p4p:5000
      - ISP=isp_b
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer5:/app/data
    ports:
      - "5005:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 6 (ISP_A, Region_A) - Source (Low Cost) [NEW]
  peer6:
    build:
      context: ../peer
    container_name: peer6_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer2_p4p:5000,peer3_p4p:5000,peer4_p4p:5000,peer5_p4p:5000,peer7_p4p:5000
      - SELF_ID=peer6_p4p:5000
      - ISP=isp_a
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer6:/app/data
    ports:
      - "5006:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

  # üß© Peer 7 (ISP_B, Region_A) - Source (High Cost) [NEW]
  peer7:
    build:
      context: ../peer
    container_name: peer7_p4p
    environment:
      - PORT=5000
      - DATA_DIR=/app/data
      - KNOWN_PEERS=peer1_p4p:5000,peer2_p4p:5000,peer3_p4p:5000,peer4_p4p:5000,peer5_p4p:5000,peer6_p4p:5000
      - SELF_ID=peer7_p4p:5000
      - ISP=isp_b
      - REGION=region_a
      - ITRACKER_URL=http://itracker:6000
    volumes:
      - ./data_peer7:/app/data
    ports:
      - "5007:5000"
    command: [ "python", "peerp4p.py" ]
    depends_on:
      - itracker
    networks:
      - p4p_net

networks:
  p4p_net:
    driver: bridge
